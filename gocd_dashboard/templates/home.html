<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
    <div class="header">
        <h1>Gocd Dashboard</h1>
    </div>
{%- for group in groups %}
    <div id="{{ group.name|lower }}" class="group {{ group.result()|lower }}">
        <h2 class="name">{{ group.name }}</h2>
        <ul>
        {%- for pipeline in group.pipelines %}
            <li id="{{ pipeline.name|lower }}" class="pipeline {{ pipeline.result()|lower }}">
                <h3 class="name">
                    <a href="{{ pipeline.link() }}">{{ pipeline.name }}/{{ pipeline.counter }}</a>
                </h3>
            {%- if not pipeline.passed() %}
            {% set failed_stage = pipeline.failed_stage() %}
                <div>
                    Failed on stage <a href="{{ failed_stage.link(pipeline) }}" class="stage">{{ failed_stage.name }}/{{ failed_stage.counter }}</a>.
                </div>
            {%- endif %}
            {%- if pipeline.pipeline_materials %}
                <div class="pipeline_materials">
                    <span>Pipelines</span>
                    <ul>
                        {%- for pipeline_material in pipeline.pipeline_materials recursive %}
                            <li class="pipeline_material">
                                <a href="{{ pipeline_material.link() }}">
                                    <code>{{ pipeline_material.name }}</code>
                                </a>
                                <ul>
                                    {{ loop(pipeline_material.pipeline_materials) }}
                                </ul>
                            </li>
                        {%- endfor %}
                    </ul>
                </div>
            {% endif %}
                <div class="git_materials">
                    <span>Commits</span>
                    <ul>
                    {%- for material in pipeline.all_git_materials() %}
                        <li class="git_material">
                            <a href="{{ material.link() }}">
                                <code>{{ material.name() }}</code>
                            </a>
                            <ul>
                                {% for modification in material.modifications %}
                                    <li>
                                        <a href="{{ modification.gh_link(material) }}">
                                            <code>{{ modification.message|truncate(80, true) }}</code>
                                        </a>
                                        <small>
                                            (<a href="mailto:{{ modification.author_email }}">{{ modification.author_name }}</a>)
                                        </small>
                                    </li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% else %}
                        <li>No materials?</li>
                        <code>{{ pipeline|pprint }}</code>
                    {%- endfor %}
                    </ul>
                </div>
            </li>
        {%- endfor %}
        </ul>
    </div>
{%- endfor %}
</body>
</html>
